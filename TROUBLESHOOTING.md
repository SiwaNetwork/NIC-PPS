# Руководство по устранению неполадок NIC-PPS

## Распространенные проблемы и решения

### 1. Ошибка: "PTP устройство не найдено для интерфейса"

**Симптомы:**
```
PTP устройство не найдено для enp3s0
✗ Ошибка при установке PPS режима output для enp3s0
```

**Причины:**
- Драйвер igc не загружен
- PTP поддержка отключена в драйвере
- Интерфейс не является TimeNIC картой

**Решение:**

1. Проверьте, что драйвер igc загружен:
```bash
lsmod | grep igc
```

2. Проверьте PTP поддержку интерфейса:
```bash
ethtool -T enp3s0
```

3. Запустите диагностический скрипт:
```bash
python debug_ptp.py
```

4. Если драйвер не загружен, установите его:
```bash
sudo ./install_igc_driver.sh
```

### 2. Ошибка: "ethtool: unexpected parameter '--pps-output'"

**Симптомы:**
```
ethtool: unexpected parameter '--pps-output'
```

**Причина:**
Код использовал несуществующие параметры ethtool. Эта проблема исправлена в последней версии.

**Решение:**
Обновите код до последней версии. PPS управление теперь осуществляется через testptp.

### 3. Ошибка при запуске CLI

**Симптомы:**
```
run.py: error: unrecognized arguments: --mode output
```

**Причина:**
Неправильная передача аргументов в CLI.

**Решение:**
Используйте правильный синтаксис:
```bash
python run.py --cli timenic set-pps enp3s0 --mode output
```

### 4. TimeNIC карты не обнаружены

**Симптомы:**
```
TimeNIC карты не обнаружены
```

**Решение:**

1. Проверьте, что у вас есть Intel I226 сетевая карта:
```bash
lspci | grep -i ethernet
```

2. Проверьте, что используется драйвер igc:
```bash
ethtool -i enp3s0 | grep driver
```

3. Перезагрузите систему после установки драйвера.

## Диагностика

### Проверка системы

Запустите полную проверку системы:
```bash
python run.py --check
```

### Отладочный скрипт

Для детальной диагностики PTP проблем:
```bash
python debug_ptp.py
```

### Логи

Проверьте системные логи:
```bash
dmesg | grep -E "igc|ptp|pps"
journalctl -xe | grep -E "igc|ptp|pps"
```

## Требования

### Системные требования
- Linux kernel 5.10+
- Intel I226 сетевая карта
- Драйвер igc с поддержкой PTP

### Необходимые утилиты
- ethtool
- testptp
- phc_ctl
- ts2phc

### Python модули
```bash
pip install -r requirements.txt
```

## Поддержка

Если проблема не решена, соберите следующую информацию:

1. Вывод `python run.py --check`
2. Вывод `python debug_ptp.py`
3. Вывод `dmesg | grep igc`
4. Версия ядра: `uname -r`
5. Информация о сетевой карте: `lspci -vv | grep -A20 Ethernet`