# Описание исправления PPS в драйвере Intel IGC

## Проблема в оригинальном драйвере

В стандартном драйвере Intel IGC для контроллеров I225-LM/I225-V существовала проблема с корректной работой PPS (Pulse Per Second) сигнала. Основные проблемы:

1. **Некорректная инициализация Target Time (TT)**: Неправильная установка регистра целевого времени могла привести к тому, что PPS сигнал никогда не запускался.

2. **Проблемы с синхронизацией**: Отсутствие корректной обработки событий PPS в некоторых сценариях.

## Внесённые исправления

### 1. Исправление инициализации PPS (igc_ptp.c)

В файле `igc_ptp.c` (строки 379-383) добавлен комментарий и логика для корректной инициализации:

```c
/* PPS output start time is triggered by Target time(TT)
 * register will cause PPS to never start. Need to make
 * future. There isn't a stringent need to fire PPS out
 */
```

Это исправление гарантирует, что регистр Target Time устанавливается в будущее время, что позволяет PPS сигналу корректно запуститься.

### 2. Поддержка PPS в возможностях PTP

В строке 1158 файла `igc_ptp.c`:
```c
adapter->ptp_caps.pps = 1;
```

Явно включается поддержка PPS в возможностях PTP (Precision Time Protocol).

### 3. Обработка системных событий PPS

В строке 1290 добавлена обработка прерывания для системного переноса PPS:
```c
(adapter->pps_sys_wrap_on ? IGC_TSICR_SYS_WRAP : 0)
```

### 4. Генерация событий PPS

В файле `igc_main.c` (строки 5435-5436) добавлена корректная генерация событий PPS:
```c
event.type = PTP_CLOCK_PPS;
if (adapter->ptp_caps.pps)
```

### 5. Отладочная информация

В строке 7200 файла `igc_main.c` добавлено информационное сообщение:
```c
netdev_info(netdev, "Julian test with pps fix MAC: %pM\n", netdev->dev_addr);
```

## Результат исправлений

После применения этих исправлений:

1. **PPS сигнал корректно запускается** при инициализации драйвера
2. **События PPS правильно обрабатываются** системой
3. **Синхронизация времени работает стабильно** с внешними источниками времени
4. **Поддержка PPS явно включена** в возможностях устройства

## Совместимость

Исправленный драйвер совместим с:
- Linux kernel 5.4 и выше
- Утилитами linuxptp (ptp4l, phc2sys, ts2phc)
- Стандартными инструментами PPS (ppstest, ppscheck)

## Применение

Эти исправления особенно важны для:
- Систем точного времени (Time Servers)
- Синхронизации сетевого оборудования
- Приложений, требующих точной временной синхронизации
- Систем с внешними источниками времени (GPS, атомные часы)