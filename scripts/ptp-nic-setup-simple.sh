#!/bin/bash

# Simplified PTP NIC Setup Script
# This script performs basic PTP device checks without pin configuration

set -e

echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ root
if [[ $EUID -ne 0 ]]; then
   echo "‚ùå –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω —Å –ø—Ä–∞–≤–∞–º–∏ root"
   echo "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: sudo $0"
   exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ PTP
if [ ! -e /dev/ptp0 ]; then
    echo "‚ùå –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ /dev/ptp0 –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    exit 1
fi

echo "‚úÖ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ PTP –Ω–∞–π–¥–µ–Ω–æ: /dev/ptp0"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
echo ""
echo "üìä –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ PTP:"
testptp -d /dev/ptp0 -c

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ PTP
echo ""
echo "üïê –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è PTP:"
testptp -d /dev/ptp0 -g

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
echo ""
echo "üîÑ –ü–æ–ø—ã—Ç–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º..."
if testptp -d /dev/ptp0 -s 2>/dev/null; then
    echo "‚úÖ –í—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ"
    echo "üïê –ù–æ–≤–æ–µ –≤—Ä–µ–º—è PTP:"
    testptp -d /dev/ptp0 -g
else
    echo "‚ö†Ô∏è  –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º"
fi

echo ""
echo "‚ÑπÔ∏è  –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–∞–Ω–Ω–æ–µ PTP —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏."
echo "    –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ TimeNIC —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:"
echo "    - –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º—ã—Ö –ø–∏–Ω–æ–≤"
echo "    - –í–Ω–µ—à–Ω–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ—Ç–æ–∫ (external timestamps)"
echo "    - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö —Å–∏–≥–Ω–∞–ª–æ–≤"
echo ""
echo "‚úÖ –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"